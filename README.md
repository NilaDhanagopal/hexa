from fastapi import FastAPI, HTTPException, Depends from pydantic import BaseModel from sqlalchemy import create_engine, Column, Integer, String, Float from sqlalchemy.ext.declarative import declarative_base from sqlalchemy.orm import sessionmaker, Session # Database setup DATABASE_URL = "sqlite:///./employees.db" engine = create_engine(DATABASE_URL, connect_args={"check_same_thread": False}) Base = declarative_base() SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine) # Employee model class Employee(Base): __tablename__ = "employees" id = Column(Integer, primary_key=True, index=True) name = Column(String, nullable=False) email = Column(String, unique=True, nullable=False) position = Column(String, nullable=False) salary = Column(Float, nullable=False) Base.metadata.create_all(bind=engine) # Pydantic models class EmployeeCreate(BaseModel): name: str email: str position: str salary: float class EmployeeUpdate(BaseModel): name: str = None email: str = None position: str = None salary: float = None # FastAPI app app = FastAPI() # Dependency def get_db(): db = SessionLocal() try: yield db finally: db.close() @app.get("/") def index(): return {"Message": "Employee management"} @app.post("/employees/", status_code=201) def create_employee(employee: EmployeeCreate, db: Session = Depends(get_db)): db_employee = Employee(**employee.dict()) db.add(db_employee) db.commit() db.refresh(db_employee) return db_employee @app.get("/employees/") def get_employees(db: Session = Depends(get_db)): return db.query(Employee).all() @app.get("/employees/{employee_id}") def get_employee(employee_id: int, db: Session = Depends(get_db)): employee = db.query(Employee).get(employee_id) if not employee: raise HTTPException(status_code=404, detail="Employee not found") return employee @app.put("/employees/{employee_id}") def update_employee(employee_id: int, employee_update: EmployeeUpdate, db: Session = Depends(get_db)): employee = db.query(Employee).get(employee_id) if not employee: raise HTTPException(status_code=404, detail="Employee not found") for key, value in employee_update.dict(exclude_unset=True).items(): setattr(employee, key, value) db.commit() db.refresh(employee) return employee @app.delete("/employees/{employee_id}") def delete_employee(employee_id: int, db: Session = Depends(get_db)): employee = db.query(Employee).get(employee_id) if not employee: raise HTTPException(status_code=404, detail="Employee not found") db.delete(employee) db.commit() return {"message": "Employee deleted successfully"} import requests BASE_URL = "http://127.0.0.1:8000/employees/" def get_input(prompt, required=False, is_float=False): value = input(prompt).strip() if required and not value: raise ValueError(f"{prompt.strip(':')} cannot be empty") if is_float and value: if not value.replace('.', '', 1).isdigit(): raise ValueError(f"{prompt.strip(':')} must be a valid number") return float(value) return value def add_employee(): try: data = { "name": get_input("Enter Name: ", required=True), "email": get_input("Enter Email: ", required=True), "position": get_input("Enter Position: ", required=True), "salary": get_input("Enter Salary: ", required=True, is_float=True) } response = requests.post(BASE_URL, json=data) print(response.json()) except ValueError as e: print(f"Error: {e}") def get_all_employees(): print(requests.get(BASE_URL).json()) def get_employee_by_id(): try: employee_id = int(get_input("Enter Employee ID: ", required=True)) print(requests.get(f"{BASE_URL}{employee_id}").json()) except ValueError: print("Error: Employee ID must be a valid number") def update_employee(): try: employee_id = int(get_input("Enter Employee ID: ", required=True)) print("Leave fields blank if you don't want to update them.") data = { "name": get_input("Enter Name: "), "email": get_input("Enter Email: "), "position": get_input("Enter Position: "), "salary": get_input("Enter Salary: ", is_float=True) } data = {k: v for k, v in data.items() if v} # Remove empty fields print(requests.put(f"{BASE_URL}{employee_id}", json=data).json()) except ValueError as e: print(f"Error: {e}") def delete_employee(): try: employee_id = int(get_input("Enter Employee ID: ", required=True)) print(requests.delete(f"{BASE_URL}{employee_id}").json()) except ValueError: print("Error: Employee ID must be a valid number") def menu(): actions = { "1": add_employee, "2": get_all_employees, "3": get_employee_by_id, "4": update_employee, "5": delete_employee } while True: print("\nEmployee Management System") print("1. Add Employee") print("2. Get All Employees") print("3. Get Employee by ID") print("4. Update Employee") print("5. Delete Employee") print("6. Exit") choice = input("Enter your choice: ").strip() if choice == "6": break action = actions.get(choice) if action: action() else: print("Invalid choice. Please try again.") if __name__ == "__main__": menu()
